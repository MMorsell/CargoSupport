@model List<CargoSupport.Models.DatabaseModels.DataModel>;
@{
    ViewData["Title"] = "Analyze";
}

<div class="text-center">
    <input type="button" class="btn btn-primary" value="Visa data för en eller flera förare" onclick="location.href='@Url.Action("AllData", "Analyze")'" />
    <input disabled type="button" class="btn btn-primary" value="Visa alla förare under en chef" onclick="location.href='@Url.Action("DriversUnderMe", "Analyze")'" />
</div>

<div class="row">
    <div style="float: right;">
        <h3 style="display: inline-block;"></h3>
        <img id="errorSymbol" style="display:none" src="~/img/svg/errorSymbol.svg" />
        <img id="onlineSymbom" style="display:none" src="~/img/svg/onlineSymbol.svg" />
        <div id="connectStatus" style="display:none" class="lds-facebook"><div style="display: inline-block;"></div><div style="display: inline-block;"></div><div style="display: inline-block;"></div></div>
    </div>
</div>
<div class="row">
    <div class="col-sm">
        <h6>Visa data</h6>
        <div>
            <div style="padding-left: 20px;" class="group">
                <label class="input-label">Från</label>
                <input type="text" id="calendar-from-vanilla">
                <span class="bar"></span>
            </div>
            <div style="padding-left: 30px;" class="group">
                <label class="input-label">Till</label>
                <input type="text" id="calendar-to-vanilla">
                <span class="bar"></span>
            </div>
        </div>
    </div>
</div>

<table id="dataTable" class="table table-striped table-bordered" style="width:100%; white-space: nowrap;">
    <thead style="position: sticky; top: 0;">
    </thead>
</table>

@section Scripts
{
    <script>
        let table;

        const driver_extendedInfo = function (data, type, full, meta) {
            if (type === 'sort' || type === 'filter') {
                return data;
            }
            return '<a class="nav-link text-dark" href="/Analyze/AllData/' + full.quinyxId + '">' + data + '</a>';
            //return '<a class="nav-link text-dark" asp-route-id="' + full.quinyxId + '" asp-area="" asp-controller="Analyze" asp-action="AllData">' + data + '</a>';
        }

        $(document).ready(function () {
            table = $('#dataTable').DataTable({
                pageLength: 250,
                "ajax": {
                    "url": '/api/Analyze/GetSlim',
                    "data": {
                        "fromDate": function () { return fromDate.format(timeFormat) },
                        "toDate": function () { return toDate.format(timeFormat) }
                    },
                    "dataSrc": ""
                },
                columnDefs: [
                    { "width": "20%", "targets": 3 }
                ],
                columns: [
                    { data: 'driverFullName', title: 'Leveransansvarig', render: driver_extendedInfo },
                    //{ data: 'driverFullName', title: 'Chef', render: driver_extendedInfo },
                    { data: 'avrWeight', title: 'Snittvikt', render: input_kilos },
                    { data: 'avrCustomers', title: 'Snitt antal kunder' },
                    { data: 'avrDrivingDistance', title: 'Snitt Kördistans i mil' },
                ],
                "order": [[1, "asc"]],

            });

            $('thead th').each(function () {
                $(this).addClass("stickyHeader");
            })

        });
    </script>
}