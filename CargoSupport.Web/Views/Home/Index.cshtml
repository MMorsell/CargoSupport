@model List<CargoSupport.Web.Models.DatabaseModels.DataModel>;
@{
    ViewData["Title"] = "Home Page";
}
<link rel="stylesheet" type="text/css"
      href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.css">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.21/css/dataTables.bootstrap4.min.css">
<link rel="stylesheet" type="text/css"
      href="https://cdn.datatables.net/rowreorder/1.2.7/css/rowReorder.bootstrap4.min.css">

<div class="container">
    <div class="row">&nbsp;</div>
    <div class="row">
        <div class="col-6">&nbsp;</div>
        <div class="col-6">
            User..........<input type="text" id="userInput" />
            <br />
            Message...<input type="text" id="messageInput" />
            <input type="button" id="sendButton" value="Send Message" />
        </div>
    </div>
    <div class="row">
        <div class="col-12">
            <hr />
        </div>
    </div>
    <div class="row">
        <div class="col-6">&nbsp;</div>
        <div class="col-6">
            <ul id="messagesList"></ul>
        </div>
    </div>
</div>
<script src="~/lib/aspnet/signalr/dist/browser/signalr.js"></script>
<script src="~/js/chat.js"></script>

<table id="example" class="table table-striped table-bordered" style="width:100%; white-space: nowrap;">
    <thead>
    </thead>
</table>
@section Scripts
{
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
            integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script type="text/javascript" charset="utf8"
            src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" charset="utf8"
            src="https://cdn.datatables.net/1.10.21/js/dataTables.bootstrap4.min.js"></script>
    <script type="text/javascript" charset="utf8"
            src="https://cdn.datatables.net/rowreorder/1.2.7/js/dataTables.rowReorder.min.js"></script>

    <script>
        let table;

        function updateRow(thisRef) {
            var dataRef = table.row($(thisRef).parents('tr')).data();

            var object = {
                id: dataRef.id,
                routeName: dataRef.routeName,
                driverFullName: dataRef.driverFullName,
                preRideAnnotation: dataRef.preRideAnnotation,
                portNumber: dataRef.portNumber,
                carNumber: dataRef.carNumber,
                routeHasStarted: dataRef.routeHasStarted,
                numberOfCustomers: dataRef.numberOfCustomers,
                tid: dataRef.tid,
                numberOfColdBoxes: dataRef.numberOfColdBoxes,
                restPlock: dataRef.restPlock,
                tidFrys: dataRef.tidFrys,
                numberOfFrozenBoxes: dataRef.numberOfFrozenBoxes,
                estimatedRouteStart: dataRef.estimatedRouteStart
            };

            //var object = {
            //    Public_Transport: nestledObject
            //};
            postUpdate(object);
        }

        function postUpdate(data) {
            debugger;
            //JSON data
            var dataType = 'application/json';

            console.log('Submitting form...');
            $.ajax({
                type: 'POST',
                url: 'https://localhost:32770/api/public/UpdateRecord',
                dataType: 'json',
                contentType: dataType,
                data: data,
                error: function (jqXHR, exception) {
                    debugger;
                },
                success: function (result) {
                    console.log('Data received: ');
                    console.log(result);
                }
            });
        }

        const simple_checkbox = function (data, type, full, meta) {
            var is_checked = data == true ? "checked" : "";
            return '<input type="checkbox" onclick=updateRow(this) class="checkbox" ' +
                is_checked + ' />';
        }

        const simple_textInput = function (data, type, full, meta) {
            return '<input type="text" onclick=updateRow(this) class="form-control" value="' +
                data + '"  />';
        }
        const simple_intInput = function (data, type, full, meta) {
            return '<input type="number" onChange=updateRow(this) class="form-control" value="' +
                data + '"  />';
        }

        $(document).ready(function () {
            table = $('#example').DataTable({
                pageLength: 100,
                "ajax": {
                    "url": "https://localhost:32770/api/public/GetTransport",
                    "dataSrc": function (response) {
                        dataR = response;
                    },
                    "dataSrc": ""
                },
                columns: [
                    {
                        data: 'id', title: 'ID', "visible": false,
                        "searchable": false
                    },
                    { data: 'routeName', title: 'Tur' },
                    { data: 'driverFullName', title: 'Lev. Ansvarig', render: simple_textInput },
                    { data: 'preRideAnnotation', title: 'Kommentar', render: simple_textInput },
                    { data: 'portNumber', title: 'Port', render: simple_intInput },
                    { data: 'carNumber', title: 'Bil', render: simple_intInput },
                    {
                        data: 'routeHasStarted', title: 'Rutt har startat', render: simple_checkbox
                    },
                    { data: 'numberOfCustomers', title: 'Kunder' },
                    { data: 'numberOfColdBoxes', title: 'Lådor' },
                    { data: 'restPlock', title: 'Restplock' },
                    { data: 'tidFrys', title: 'Tid Frys' },
                    { data: 'numberOfFrozenBoxes', title: 'Frys' },
                    { data: 'tid', title: 'Tid' },
                    { data: 'estimatedRouteStart', title: 'pinstart' },
                ],
                "order": [[0, "asc"]],

            });

        });
        function reloadAjax() {
            table.ajax.reload(null, false);
        }
    </script>
}